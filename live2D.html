<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Simple Live2D</title>
<style>
body { margin: 0; overflow:hidden }
canvas { width: 100%; height: 100% }
</style>
</head>

<body>

<script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyC9qHTDbivKGICUe1eqmn6ILJKHdErUzyA",
    authDomain: "test-8cda8.firebaseapp.com",
    databaseURL: "https://test-8cda8.firebaseio.com",
    projectId: "test-8cda8",
    storageBucket: "test-8cda8.appspot.com",
    messagingSenderId: "863744517699"
  };
  firebase.initializeApp(config);
</script>

<script src="three/build/three.js"></script>

<!-- Live2Dのコアライブラリ -->
<script src="three/build/Live2D/lib/live2d.min.js"></script>

<!-- Live2Dの便利機能が入ったクラス群 -->
<script src="three/build/Live2D/framework/Live2DFramework.js"></script>

<!-- Live2Dモデルやテクスチャロード管理クラス -->
<script src="three/build/Live2D/sample/sampleApp1/src/PlatformManager.js"></script>

<!-- Live2Dモデルの生成やチェンジを行うクラス -->
<script src="three/build/Live2D/sample/sampleApp1/src/LAppLive2DManager.js"></script>

<!-- Three.js用のカスタムクラス -->
<script src="three/build/Live2D/Live2DRender.js"></script>

<script>
	
	var scene,camera,renderer;
	var offScene1,offRenderTarget1,live2dModel1;
	
	init();
	
	function init(){
	
		scene=new THREE.Scene();
		
		camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
		camera.position.z=5;
		
		renderer=new THREE.WebGLRenderer();
		renderer.setSize(window.innerWidth,window.innerHeight);
		document.body.appendChild(renderer.domElement);
		
		offScene1=new THREE.Scene();
		offRenderTarget1 = new THREE.WebGLRenderTarget(
			window.innerWidth,
			window.innerHeight,
			{
				minFilter: THREE.LinearFilter,
				magFilter: THREE.NearestFilter,
				format: THREE.RGBAFormat
			}
		);
		
		var textureLoader = new THREE.TextureLoader();
		// 背景テクスチャのロード
		var background = textureLoader.load("three/build/Live2D/sample/sampleApp1/assets/image/back_class_normal.png");
		// プレーン生成
		var backgeo = new THREE.PlaneGeometry( 8, 8, 1, 1 );
		var backmat = new THREE.MeshBasicMaterial( { map: background } );
		var backmesh = new THREE.Mesh( backgeo, backmat );
		scene.add( backmesh );
		
		var MODEL_PATH1="three/build/Live2D/sample/sampleApp1/assets/live2d/Epsilon2.1/";
		var MODEL_JSON1 ="Epsilon2.1.model.json";
		
		live2dModel1=new THREE.Live2DRender(renderer,MODEL_PATH1,MODEL_JSON1);
		
		var geometry1=new THREE.PlaneGeometry(6,6,1,1);
		var material1=new THREE.MeshBasicMaterial({map:offRenderTarget1.texture});
		var plane1=new THREE.Mesh(geometry1,material1);
		plane1.position.y=-0.85;
		
		plane1.material.transparent=true;
		scene.add(plane1);
		
		window.addEventListener('resize',onWindowResize,false);
		
		document.addEventListener('contextmenu',onDocumentContextmenu,false);
		document.addEventListener('mousedown',onDocumentMouseDown,false);
		
	}
	
	function onWindowResize(){
	
		renderer.setSize(window.innerWidth,window.innerHeight);
		
		offRenderTarget1.setSize(window.innerWidth,window.innerHeight);
		
		live2dModel1.setMouseView(renderer);
		
		camera.aspect=window.innerWidth/window.innerHeight;
		camera.updateProjectionMatrix();
	}
	
	function onDocumentContextmenu(e){
		e.preventDefault();
	}
	
	function onDocumentMouseDown(e){
		switch(e.button){
			case 0:
				live2dModel1.setRandomMotion();
				break;
				
			case 2:
				live2dModel1.setRandomExpression();
				break;
		}
	}
	
	var render=function(){
	
		requestAnimationFrame(render);
		renderer.render(offScene1,camera,offRenderTarget1);
		live2dModel1.draw();
		renderer.state.reset();
		renderer.render(scene,camera);
	}
	
	render();
	
</script>

</body>
</html>